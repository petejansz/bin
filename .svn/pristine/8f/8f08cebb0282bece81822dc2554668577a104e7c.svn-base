param
(
    [string]$USERNAME,
    [string]$PASSWORD,
    [switch]$help,
    [switch]$h 
)

Set-PSDebug -Off #Trace 2

function showHelp()
{
    echo "USAGE: rest-test1 -username <username> -password <password>"
    exit 1
}

if (-not($USERNAME))
{
    showHelp
}

if (-not($PASSWORD))
{
    showHelp
}

function create_body($username, $password)
{
    $resourceOwnerCredentials = New-Object PsObject -Property @{
        USERNAME = $username
        PASSWORD  = $password
    }

    $body = New-Object PsObject -Property @{
        siteId = "35"
        clientId = "SolSet2ndChancePortal"        
        resourceOwnerCredentials = $resourceOwnerCredentials
    }

    return ($body | ConvertTo-Json -depth 3)
}

function execRest ([string]$body) # [string] $authCode
{
    $uri = "http://cadev1.gtech.com/api/v1/oauth/login"
    $header = @{                                `
        'Content-Type' = 'application/json' ;   `
        'x-ex-system-id' = '8'              ;   `
        'x-channel-id' = '2'                ;   `
        'x-site-id' = '35'                  ;   `
        }
    
    $resp = iwr -uri $uri -Method POST -Body $body -Headers $header 
    $resp.Headers #| convertfrom-json
    return ($resp.content | ConvertFrom-Json).authcode
}

$body = create_body $username $password
$result = execRest $body
$result